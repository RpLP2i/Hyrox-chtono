<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>LP'ROX ‚Äì Chronom√®tre</title>

<style>
body {
    margin: 0;
    background: black;
    color: white;
    font-family: Arial, sans-serif;
    height: 100vh;
}

/* ===== HEADER ===== */
.header {
    position: absolute;
    top: 20px;
    left: 20px;
    right: 20px;
    display: flex;
    align-items: center;
}

.logo {
    height: 150px;
}

.title {
    flex: 1;
    text-align: center;
    font-size: 140px;
    font-weight: bold;
    color: white;
}

/* ===== LAYOUT ===== */
.container {
    display: flex;
    height: 100vh;
    padding-top: 200px;
}

.left {
    flex: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.time {
    font-size: 140px;
    font-weight: bold;
}

.controls {
    text-align: center;
}

.controls input,
.controls button {
    font-size: 18px;
    padding: 6px 12px;
    margin: 5px;
}

.right {
    flex: 1;
    background: #111;
    padding: 15px;
    overflow-y: auto;
}

/* ===== TABLE ===== */
table {
    width: 100%;
    border-collapse: collapse;
    font-size: 16px;
}

th, td {
    border-bottom: 1px solid #444;
    padding: 6px;
    text-align: center;
}

button.teamStop {
    font-size: 14px;
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<div class="header">
    <img src="logo.png" class="logo">
    <div class="title">LP'ROX</div>
</div>

<div class="container">

    <div class="left">
        <div class="time" id="chrono">00:00:00</div>

        <div class="controls">
            ‚è≥ Compte √† rebours (s) :
            <input type="number" id="countdown" value="10" min="0"><br>

            üë• Nombre d‚Äô√©quipes :
            <input type="number" id="teamsCount" value="5" min="1" max="30"><br>

            ‚è±Ô∏è Intervalle d√©part (min) :
            <input type="number" id="interval" value="1" min="1"><br><br>

            <button onclick="startRace()">‚ñ∂Ô∏è D√©marrer</button>
            <button onclick="pauseRace()">‚è∏Ô∏è Pause</button>
            <button onclick="resumeRace()">‚ñ∂Ô∏è Reprendre</button>
            <button onclick="stopRace()">‚èπÔ∏è Stop</button>
        </div>
    </div>

    <div class="right">
        <h2>D√©parts √©quipes</h2>
        <table id="teamTable">
            <tr>
                <th>√âquipe</th>
                <th>D√©calage</th>
                <th>Temps</th>
                <th>Arr√™t</th>
            </tr>
        </table>
    </div>

</div>

<script>
/* ===== VARIABLES ===== */
let startTime = null;
let elapsed = 0;
let running = false;
let paused = false;
let chronoTimer = null;
let countdownTimer = null;
let teams = [];
let announcements = [];

/* ===== VOIX (MEILLEURE POSSIBLE NAVIGATEUR) ===== */
function speak(text) {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "fr-FR";
    u.rate = 0.85;
    u.pitch = 0.7;
    u.volume = 1;

    const voices = speechSynthesis.getVoices();
    const preferred = voices.find(v =>
        v.lang === "fr-FR" &&
        (v.name.includes("Google") || v.name.includes("Microsoft"))
    );

    if (preferred) u.voice = preferred;

    speechSynthesis.cancel();
    speechSynthesis.speak(u);
}

/* ===== FORMAT ===== */
function format(ms) {
    if (ms < 0) return "--:--:--";
    const s = Math.floor(ms / 1000);
    const h = Math.floor(s / 3600);
    const m = Math.floor((s % 3600) / 60);
    const sec = s % 60;
    return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
}

/* ===== √âQUIPES ===== */
function generateTeams(count, intervalMin) {
    teams = [];
    announcements = [];

    const table = document.getElementById("teamTable");
    table.innerHTML = `
        <tr>
            <th>√âquipe</th>
            <th>D√©calage</th>
            <th>Temps</th>
            <th>Arr√™t</th>
        </tr>`;

    for (let i = 0; i < count; i++) {
        const delay = i * intervalMin * 60000;
        teams.push({ letter: String.fromCharCode(65 + i), delay, finished: false, time: 0 });
        announcements.push(false);

        const row = table.insertRow();
        row.insertCell().innerText = teams[i].letter;
        row.insertCell().innerText = `${i} min`;
        row.insertCell().id = "time" + i;

        const btn = document.createElement("button");
        btn.innerText = "STOP";
        btn.className = "teamStop";
        btn.onclick = () => stopTeam(i);
        row.insertCell().appendChild(btn);
    }
}

/* ===== D√âMARRAGE ===== */
function startRace() {
    stopRace();

    const cd = Number(document.getElementById("countdown").value);
    const count = Number(document.getElementById("teamsCount").value);
    const interval = Number(document.getElementById("interval").value);

    generateTeams(count, interval);

    let remaining = cd;
    running = false;
    paused = false;

    countdownTimer = setInterval(() => {
        if (remaining > 0) {
            speak(remaining.toString());
            remaining--;
        } else {
            clearInterval(countdownTimer);
            speak("D√©part √©quipe A");

            startTime = Date.now();
            elapsed = 0;
            running = true;

            chronoTimer = setInterval(updateChrono, 100);
        }
    }, 1000);
}

/* ===== CHRONO ===== */
function updateChrono() {
    if (!running || paused) return;

    elapsed = Date.now() - startTime;
    document.getElementById("chrono").innerText = format(elapsed);

    teams.forEach((t, i) => {
        if (!t.finished && elapsed >= t.delay) {
            document.getElementById("time" + i).innerText = format(elapsed - t.delay);
        }
        if (!announcements[i] && elapsed >= t.delay) {
            speak(`D√©part √©quipe ${t.letter}`);
            announcements[i] = true;
        }
    });
}

/* ===== ACTIONS ===== */
function stopTeam(i) {
    if (teams[i].finished) return;
    teams[i].finished = true;
    teams[i].time = elapsed - teams[i].delay;
    document.getElementById("time" + i).innerText = format(teams[i].time);
}

function pauseRace() {
    if (!running || paused) return;
    paused = true;
}

function resumeRace() {
    if (!running || !paused) return;
    paused = false;
    startTime = Date.now() - elapsed;
}

function stopRace() {
    running = false;
    paused = false;
    clearInterval(chronoTimer);
    clearInterval(countdownTimer);
    elapsed = 0;
    document.getElementById("chrono").innerText = "00:00:00";
    speechSynthesis.cancel();
}
</script>

</body>
</html>
