<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Chronom√®tre Course √âquipes</title>
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: black;
    color: white;
    display: flex;
    height: 100vh;
}
.left {
    flex: 2;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
.time {
    font-size: 140px;
    font-weight: bold;
}
.controls {
    margin-top: 20px;
    text-align: center;
}
input, button {
    font-size: 18px;
    padding: 6px 12px;
    margin: 5px;
}
.right {
    flex: 1;
    background: #111;
    padding: 20px;
    overflow-y: auto;
}
table {
    width: 100%;
    border-collapse: collapse;
    font-size: 18px;
}
th, td {
    border-bottom: 1px solid #444;
    padding: 6px;
    text-align: center;
}
th {
    background: #222;
}
</style>
</head>

<body>

<div class="left">
    <div class="time" id="chrono">00:00:00</div>

    <div class="controls">
        ‚è±Ô∏è Compte √† rebours (s) :
        <input type="number" id="countdown" value="10" min="0"><br>

        üë• Nombre d‚Äô√©quipes :
        <input type="number" id="teams" value="5" min="1" max="30"><br>

        ‚è±Ô∏è Intervalle (min) :
        <input type="number" id="interval" value="1" min="1"><br><br>

        <button onclick="startRace()">‚ñ∂Ô∏è D√©marrer</button>
        <button onclick="togglePause()">‚è∏Ô∏è Pause</button>
        <button onclick="stopRace()">‚èπÔ∏è Stop</button>
    </div>
</div>

<div class="right">
    <h2>D√©parts √©quipes</h2>
    <table id="teamTable">
        <tr><th>√âquipe</th><th>D√©part</th></tr>
    </table>
</div>

<script>
let startTime = 0;
let elapsedBeforePause = 0;
let chronoInterval = null;
let announcements = [];
let paused = false;
let running = false;

function speak(text) {
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = "fr-FR";
    speechSynthesis.speak(msg);
}

function formatTime(ms) {
    const totalSeconds = Math.floor(ms / 1000);
    const h = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
    const m = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
    const s = String(totalSeconds % 60).padStart(2, '0');
    return `${h}:${m}:${s}`;
}

function generateTeams(n, interval) {
    const table = document.getElementById("teamTable");
    table.innerHTML = `<tr><th>√âquipe</th><th>D√©part</th></tr>`;
    announcements = [];

    for (let i = 0; i < n; i++) {
        const letter = String.fromCharCode(65 + i);
        const delay = i * interval * 60 * 1000;

        announcements.push({ letter, delay, announced: false });

        const row = table.insertRow();
        row.insertCell(0).innerText = letter;
        row.insertCell(1).innerText = `${i} min`;
    }
}

function startRace() {
    stopRace();
    const countdown = Number(document.getElementById("countdown").value);
    const teams = Number(document.getElementById("teams").value);
    const interval = Number(document.getElementById("interval").value);

    generateTeams(teams, interval);
    let remaining = countdown;
    running = true;
    paused = false;

    const cd = setInterval(() => {
        if (!running) {
            clearInterval(cd);
            return;
        }
        if (remaining > 0) {
            speak(remaining.toString());
            remaining--;
        } else {
            clearInterval(cd);
            speak("D√©part √©quipe A");
            startTime = Date.now();
            elapsedBeforePause = 0;
            chronoInterval = setInterval(updateChrono, 100);
        }
    }, 1000);
}

function updateChrono() {
    if (paused) return;
    const elapsed = Date.now() - startTime + elapsedBeforePause;
    document.getElementById("chrono").innerText = formatTime(elapsed);

    announcements.forEach(team => {
        if (!team.announced && elapsed >= team.delay) {
            speak(`D√©part √©quipe ${team.letter}`);
            team.announced = true;
        }
    });
}

function togglePause() {
    if (!running) return;

    if (!paused) {
        paused = true;
        elapsedBeforePause += Date.now() - startTime;
        speechSynthesis.cancel();
    } else {
        paused = false;
        startTime = Date.now();
    }
}

function stopRace() {
    running = false;
    paused = false;
    elapsedBeforePause = 0;
    clearInterval(chronoInterval);
    speechSynthesis.cancel();
    document.getElementById("chrono").innerText = "00:00:00";
}
</script>

</body>
</html>
